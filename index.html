<!DOCTYPE html>
<html lang="ms">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Jabatan Pengairan dan Saliran Kuala Nerus</title>
  <meta name="description" content="Laman Rasmi JPS Kuala Nerus. Info banjir, peta interaktif, data hujan dan aras sungai, serta permohonan rasmi.">
  <meta name="keywords" content="JPS Kuala Nerus, Banjir Terengganu, Peta Interaktif, Data Hujan, OSC, Permohonan Sungai">
  <meta name="author" content="Jabatan Pengairan dan Saliran Daerah Kuala Nerus">
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" href="favicon.ico" type="image/x-icon">

  <style>
    /* ================= GLOBAL STYLES ================= */
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f7f6;
      color: #333;
      padding-top: 0;
    }

    h1, h2, h3, h4 { color: #004d99; }
    a { text-decoration: none; color: #0073e6; transition: 0.3s; }
    a:hover { color: #0056b3; text-decoration: underline; }

    /* ================= HEADER & NAV ================= */
    .top-bar {
      background: #004a99;
      color: white;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .live-data span { margin-right: 15px; display: inline-block; }
    .live-data strong { color: #ffe066; }

    header.main-header {
      background: #fff;
      padding: 1rem;
      text-align: center;
      border-bottom: 4px solid #0073e6;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .logo-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 0.5rem;
      flex-wrap: wrap;
    }
    .logo-container img { height: 80px; width: auto; }
    .main-title { font-size: 1.8rem; font-weight: 800; text-transform: uppercase; margin: 0; color: #003366; }

    /* Navigation Bar */
    nav.navbar {
      background-color: #0073e6;
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 1rem;
      width: 100%;
    }
    .nav-toggle {
      background: none;
      border: none;
      color: white;
      font-size: 1.8rem;
      cursor: pointer;
      display: none; /* Hidden on desktop */
      padding: 10px;
    }
    .nav-menu {
      list-style: none;
      display: flex;
      gap: 5px;
      margin: 0;
      padding: 0;
    }
    .nav-menu li { position: relative; }
    .nav-menu a {
      color: white;
      padding: 1rem 1.2rem;
      display: block;
      font-weight: 600;
    }
    .nav-menu a:hover { background: #005fa3; color: #ffd700; text-decoration: none; }

    /* Dropdown */
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #005fa3;
      min-width: 200px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      top: 100%;
      left: 0;
      z-index: 1000;
    }
    .dropdown:hover .dropdown-content { display: block; }
    .dropdown-content li a { padding: 10px 15px; font-size: 0.95rem; border-bottom: 1px solid rgba(255,255,255,0.1); }

    /* ================= SECTIONS & CONTENT ================= */
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    section {
      background: white;
      padding: 2rem;
      margin-bottom: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      scroll-margin-top: 80px; /* Fix anchor offset */
    }
    
    /* Map Styling */
    #mapContainer { position: relative; width: 100%; height: 500px; border-radius: 8px; overflow: hidden; }
    #map { width: 100%; height: 100%; }
    .map-toggle-btn {
      background: #0073e6; color: white; border: none; padding: 8px 16px; 
      border-radius: 5px; cursor: pointer; margin-bottom: 10px;
    }
    
    /* Tables */
    .responsive-table { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 12px; border: 1px solid #ddd; text-align: center; }
    th { background: #004d99; color: white; }
    tr:nth-child(even) { background: #f9f9f9; }

    /* Buttons */
    .btn-primary { background-color: #0073e6; border-color: #0073e6; }
    .btn-primary:hover { background-color: #005bb5; }

    /* Footer */
    footer {
      background: #003366;
      color: white;
      padding: 3rem 1rem;
      margin-top: 3rem;
    }
    .footer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .footer-col h4 { color: #ffd700; margin-bottom: 1rem; font-size: 1.2rem; }
    .footer-col p, .footer-col a { color: #ddd; font-size: 0.95rem; line-height: 1.6; }
    .footer-col a:hover { color: #fff; }

    /* ================= MOBILE RESPONSIVE ================= */
    @media (max-width: 900px) {
      .nav-toggle { display: block; }
      .nav-menu {
        display: none;
        flex-direction: column;
        width: 100%;
        background: #0073e6;
        position: absolute;
        top: 60px; /* height of navbar */
        left: 0;
      }
      .nav-menu.active { display: flex; }
      .nav-menu li { width: 100%; border-bottom: 1px solid #005bb5; }
      .dropdown-content { position: static; box-shadow: none; background: #005bb5; }
      .main-title { font-size: 1.2rem; }
      .logo-container img { height: 60px; }
      .top-bar { flex-direction: column; text-align: center; gap: 0.5rem; }
    }
    
    /* Utility */
    #backToTop {
      position: fixed; bottom: 20px; right: 20px; z-index: 99;
      background: #ffd700; color: #003366; border: none; padding: 10px 15px;
      border-radius: 50%; cursor: pointer; display: none; font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
  </style>
</head>

<body>

  <div class="top-bar">
    <div class="live-data">
      <span>üåßÔ∏è Hujan: <strong id="rain-mm">0 mm</strong></span>
      <span>üåä Sg. Nerus: <strong id="river-level">Loading...</strong></span>
    </div>
    <div id="date-time-text">Loading Date...</div>
  </div>

  <header class="main-header">
    <div class="logo-container">
      <img src="jpslogo.png" alt="Logo JPS" onerror="this.style.display='none'"> 
      <img src="trglogo.png" alt="Logo Terengganu" onerror="this.style.display='none'">
    </div>
    <h1 class="main-title">Jabatan Pengairan dan Saliran<br>Daerah Kuala Nerus</h1>
  </header>

  <nav class="navbar">
    <div class="nav-container">
      <button class="nav-toggle" aria-label="Menu">‚ò∞</button>
      <ul class="nav-menu">
        <li><a href="#about">Profil</a></li>
        <li class="dropdown">
          <a href="#services">Perkhidmatan</a>
          <ul class="dropdown-content">
            <li><a href="#ruangan-iklan">Iklan & Tender</a></li>
            <li><a href="#news-section">Berita</a></li>
            <li><a href="#laporan-osc">Laporan OSC</a></li>
          </ul>
        </li>
        <li><a href="#map-section">Peta Interaktif</a></li>
        <li><a href="#hydrology-data">Data Hidrologi</a></li>
        <li class="dropdown">
          <a href="#">Info Banjir</a>
          <ul class="dropdown-content">
            <li><a href="https://publicinfobanjir.water.gov.my/" target="_blank">Public Infobanjir</a></li>
            <li><a href="https://jpsweb.terengganu.gov.my/" target="_blank">JPS Terengganu</a></li>
          </ul>
        </li>
        <li><a href="#contact">Hubungi Kami</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">

    <section id="about">
      <h2>Profil Kami</h2>
      <p class="lead">"Jayakan Perkhidmatan Sempurna"</p>
      <p>
        Jabatan Pengairan dan Saliran (JPS) Daerah Kuala Nerus bertanggungjawab dalam pengurusan sumber air,
        sistem saliran bandar, tebatan banjir, serta pembangunan infrastruktur saliran di Kuala Nerus.
      </p>
      
      <div class="alert alert-info mt-3">
        <strong>Jurutera Daerah:</strong> Ir. Pn. Aisyah binti Abu Bakar
      </div>

      <div id="jpsGallery" class="carousel slide mt-4" data-bs-ride="carousel">
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#jpsGallery" data-bs-slide-to="0" class="active"></button>
          <button type="button" data-bs-target="#jpsGallery" data-bs-slide-to="1"></button>
        </div>
        <div class="carousel-inner rounded">
          <div class="carousel-item active">
            <img src="images/before-flood1.jpg" class="d-block w-100" style="height:400px; object-fit:cover; background:#ccc;" alt="Projek 1">
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded">
              <h5>Projek Tebatan Banjir Kg. Tepoh</h5>
            </div>
          </div>
          <div class="carousel-item">
             <img src="images/after-flood1.jpg" class="d-block w-100" style="height:400px; object-fit:cover; background:#ccc;" alt="Projek 2">
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded">
              <h5>Penyelenggaraan Sungai Nerus</h5>
            </div>
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#jpsGallery" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#jpsGallery" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
        </button>
      </div>
    </section>

    <section id="map-section">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>üó∫Ô∏è Peta Interaktif & Status Semasa</h2>
        <button id="toggleMapBtn" class="btn btn-outline-primary btn-sm">Sembunyi Peta</button>
      </div>
      
      <div id="mapContainer">
        <div id="map"></div>
      </div>
      <p class="text-muted mt-2 text-center small">Peta menunjukkan lokasi pejabat, stesen hujan, dan status aras sungai terkini.</p>
    </section>

    <section id="hydrology-data">
      <h2>üìä Data Hidrologi (Hujan & Sungai)</h2>
      <button id="viewToggleBtn" class="btn btn-secondary mb-3">Lihat Carta Grafik üìà</button>

      <div id="tableView" class="responsive-table">
        <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>Nama Stesen</th>
              <th>Jenis</th>
              <th>Bacaan Terkini</th>
              <th>Status</th>
              <th>Kemaskini</th>
            </tr>
          </thead>
          <tbody id="hydroTableBody">
            </tbody>
        </table>
      </div>

      <div id="chartView" style="display:none;">
        <canvas id="hydroChart" height="100"></canvas>
      </div>
    </section>

    <section id="services">
      <h2>üìÇ Perkhidmatan & Dokumen</h2>
      <div class="row">
        <div class="col-md-6 mb-3">
          <div class="card h-100">
            <div class="card-header bg-primary text-white">Muat Turun Borang</div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item"><a href="#">üì• Borang Permohonan Rezab Sungai</a></li>
              <li class="list-group-item"><a href="#">üì• Borang Aduan Awam</a></li>
              <li class="list-group-item"><a href="#">üì• Garis Panduan Saliran Mesra Alam (MSMA)</a></li>
            </ul>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="card h-100">
            <div class="card-header bg-warning text-dark">Tender & Sebut Harga</div>
            <div class="card-body">
              <p>Tiada tawaran tender dibuka pada masa ini.</p>
              <small class="text-muted">Sila semak semula secara berkala.</small>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="laporan-osc">
      <h3>üìë Laporan Ulasan OSC</h3>
      <p>Senarai ulasan teknikal rasmi:</p>
      <ul>
        <li><a href="#">Ulasan Teknikal Projek Perumahan Bukit Tok Beng (Mei 2025)</a></li>
        <li><a href="#">Ulasan Teknikal Dewan Orang Ramai Batu Rakit (April 2025)</a></li>
      </ul>
    </section>

    <section id="contact">
      <h2>üìû Hubungi Kami</h2>
      <div class="row">
        <div class="col-md-6">
          <p><strong>Jabatan Pengairan dan Saliran Daerah Kuala Nerus</strong></p>
          <p>
            Kompleks Pentadbiran Bandar Al Wathiqu Billah,<br>
            21300 Kuala Nerus, Terengganu Darul Iman.
          </p>
          <p>
            ‚òéÔ∏è <strong>Tel:</strong> 09-665 3010<br>
            üìß <strong>Emel:</strong> jpskn@terengganu.gov.my
          </p>
          <p><strong>Waktu Operasi:</strong> Ahad - Khamis (8:00 PG - 5:00 PTG)</p>
        </div>
        <div class="col-md-6">
          <iframe 
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3965.9427382226065!2d103.0594323147693!3d5.394480096086208!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31b7b0496843657f%3A0x6b44788383324021!2sKuala%20Nerus!5e0!3m2!1sen!2smy!4v1625633000000!5m2!1sen!2smy" 
            width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy">
          </iframe>
        </div>
      </div>
    </section>

  </div> <footer>
    <div class="footer-grid">
      <div class="footer-col">
        <h4>JPS Kuala Nerus</h4>
        <p>Meneraju pengurusan sumber air dan saliran yang mampan demi kesejahteraan rakyat Kuala Nerus.</p>
      </div>
      <div class="footer-col">
        <h4>Pautan Pantas</h4>
        <p><a href="#about">Profil</a> | <a href="#services">Perkhidmatan</a></p>
        <p><a href="https://jpsweb.terengganu.gov.my/" target="_blank">Portal JPS Negeri Terengganu</a></p>
        <p><a href="https://publicinfobanjir.water.gov.my/" target="_blank">Public Infobanjir Malaysia</a></p>
      </div>
      <div class="footer-col">
        <h4>Bantuan</h4>
        <p><a href="#contact">Hubungi Kami</a></p>
        <p><a href="#">Soalan Lazim (FAQ)</a></p>
      </div>
    </div>
    <div style="text-align:center; margin-top:2rem; border-top:1px solid rgba(255,255,255,0.2); padding-top:1rem;">
      <small>&copy; 2025 Jabatan Pengairan dan Saliran Daerah Kuala Nerus. Hak Cipta Terpelihara.</small>
    </div>
  </footer>

  <button id="backToTop" title="Kembali ke atas">‚¨Ü</button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // --- 1. CLOCK & DATE ---
    function updateClock() {
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
      document.getElementById("date-time-text").textContent = now.toLocaleDateString("ms-MY", options);
    }
    setInterval(updateClock, 1000);
    updateClock();

    // --- 2. MOBILE MENU ---
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');
    navToggle.addEventListener('click', () => {
      navMenu.classList.toggle('active');
      navToggle.textContent = navMenu.classList.contains('active') ? '‚úï' : '‚ò∞';
    });

    // --- 3. DATA & MAP INITIALIZATION ---
    // Fake Data Source (In real app, fetch from API)
    const stationsData = [
      { name: "Sg. Nerus (Kg. Jeram)", type: "river", level: 4.5, status: "Bahaya", rain: 22, lat: 5.400, lng: 103.070 },
      { name: "Sg. Batu Rakit", type: "river", level: 2.3, status: "Amaran", rain: 12, lat: 5.460, lng: 103.100 },
      { name: "Sg. Tepoh", type: "river", level: 1.1, status: "Normal", rain: 5, lat: 5.370, lng: 103.072 },
      { name: "Stesen Hujan Gong Badak", type: "rain", level: null, status: "Normal", rain: 45, lat: 5.395, lng: 103.085 }
    ];

    document.addEventListener("DOMContentLoaded", () => {
      // A. Populate Top Bar & Table
      const rainSpan = document.getElementById('rain-mm');
      const riverSpan = document.getElementById('river-level');
      const tableBody = document.getElementById('hydroTableBody');
      
      // Update Top Bar Summary
      rainSpan.textContent = stationsData[3].rain + " mm";
      riverSpan.innerHTML = `${stationsData[0].level} m <span class="badge bg-danger">Bahaya</span>`;

      // Populate Table
      stationsData.forEach(st => {
        let statusColor = st.status === 'Bahaya' ? 'text-danger fw-bold' : 
                          (st.status === 'Amaran' ? 'text-warning fw-bold' : 'text-success');
        
        let row = `<tr>
          <td>${st.name}</td>
          <td>${st.type === 'river' ? 'Sungai' : 'Hujan'}</td>
          <td>${st.type === 'river' ? st.level + ' m' : st.rain + ' mm'}</td>
          <td class="${statusColor}">${st.status}</td>
          <td>${new Date().toLocaleTimeString()}</td>
        </tr>`;
        tableBody.innerHTML += row;
      });

      // B. Initialize Map
      const map = L.map('map').setView([5.400, 103.080], 11);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
      }).addTo(map);

      // Add Markers
      const markers = L.markerClusterGroup();
      stationsData.forEach(st => {
        let color = st.status === 'Bahaya' ? 'red' : (st.status === 'Amaran' ? 'gold' : 'green');
        
        // Custom colored icon
        const icon = new L.Icon({
          iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-${color}.png`,
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: [25, 41],
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });

        markers.addLayer(L.marker([st.lat, st.lng], {icon: icon})
          .bindPopup(`<b>${st.name}</b><br>Status: ${st.status}<br>Hujan: ${st.rain}mm`));
      });
      map.addLayer(markers);

      // C. Toggle Map Visibility
      document.getElementById('toggleMapBtn').addEventListener('click', function() {
        const container = document.getElementById('mapContainer');
        if (container.style.display === 'none') {
          container.style.display = 'block';
          this.textContent = 'Sembunyi Peta';
        } else {
          container.style.display = 'none';
          this.textContent = 'Lihat Peta';
        }
      });

      // D. Chart.js Logic
      const ctx = document.getElementById('hydroChart').getContext('2d');
      const chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: stationsData.map(s => s.name),
          datasets: [{
            label: 'Jumlah Hujan (mm)',
            data: stationsData.map(s => s.rain),
            backgroundColor: '#0073e6'
          }]
        }
      });

      // View Toggle (Table vs Chart)
      document.getElementById('viewToggleBtn').addEventListener('click', function() {
        const tbl = document.getElementById('tableView');
        const cht = document.getElementById('chartView');
        if (tbl.style.display !== 'none') {
          tbl.style.display = 'none';
          cht.style.display = 'block';
          this.textContent = 'Lihat Jadual Data üìã';
        } else {
          tbl.style.display = 'block';
          cht.style.display = 'none';
          this.textContent = 'Lihat Carta Grafik üìà';
        }
      });
    });

    // --- 4. BACK TO TOP BUTTON ---
    const backBtn = document.getElementById('backToTop');
    window.onscroll = () => {
      backBtn.style.display = (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) ? "block" : "none";
    };
    backBtn.onclick = () => {
      window.scrollTo({top: 0, behavior: 'smooth'});
    };
  </script>
</body>
</html>